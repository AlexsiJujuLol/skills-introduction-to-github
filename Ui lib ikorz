-- Kavo UI Library: Load UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("Auto Parry", "DarkTheme")

-- Tabs
local MainTab = Window:NewTab("Main")
local SettingsTab = Window:NewTab("Settings")

-- Sections
local MainSection = MainTab:NewSection("Auto Parry")
local SettingsSection = SettingsTab:NewSection("Settings")

-- Variables
getgenv().AutoParryEnabled = false
getgenv().DetectionRange = 20 -- Default detection range (20 studs)

-- Auto Parry Toggle
MainSection:NewToggle("Enable Auto Parry", "Toggles the Auto Parry feature.", function(state)
    getgenv().AutoParryEnabled = state
    if state then
        print("[INFO] Auto Parry Enabled")
    else
        print("[INFO] Auto Parry Disabled")
    end
end)

-- Detection Range Slider
MainSection:NewSlider("Detection Range", "Adjust the range to detect threats.", 50, 10, function(value)
    getgenv().DetectionRange = value
    print("[INFO] Detection Range set to: " .. value)
end)

-- Keybind to Toggle UI
SettingsSection:NewKeybind("Toggle UI", "Toggle the UI visibility.", Enum.KeyCode.RightShift, function()
    Library:ToggleUI()
end)

-- Auto Parry Logic
game:GetService("RunService").RenderStepped:Connect(function()
    if getgenv().AutoParryEnabled then
        detectAndTriggerParry()
    end
end)

-- Detect Closest Threat (Example Logic)
function detectClosestThreat()
    local closestPlayer = nil
    local closestDistance = getgenv().DetectionRange -- Detection range set by the user
    local localPlayer = game.Players.LocalPlayer
    local localCharacter = localPlayer.Character

    if not localCharacter or not localCharacter:FindFirstChild("HumanoidRootPart") then
        return nil
    end

    for _, player in pairs(game.Players:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (player.Character.HumanoidRootPart.Position - localCharacter.HumanoidRootPart.Position).Magnitude
            if distance < closestDistance then
                closestDistance = distance
                closestPlayer = player
            end
        end
    end

    return closestPlayer
end

-- Trigger Parry (Example Logic)
function triggerParry()
    print("[INFO] Parry Triggered!")
    -- Replace this logic with the specific RemoteEvent or action your game requires.
end

-- Detect and Trigger Parry
function detectAndTriggerParry()
    local closestThreat = detectClosestThreat()
    if closestThreat then
        print("[INFO] Threat detected: " .. closestThreat.Name)
        triggerParry()
    end
end
