local Ikorz = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Ikorz:CreateWindow({
    Title = "Ikorz",
    SubTitle = "by dawid",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = false, -- Disable the blur effect
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" }),
    BladeBal = Window:AddTab({ Title = "Blade Bal", Icon = "sword" })
}

local Options = Ikorz.Options

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Player = Players.LocalPlayer

local AutoParryEnabled = false
local ReactionTime = 1.8905  -- Updated reaction time in seconds
local DetectionRange = 10    -- Detection range in studs
local Cooldown = tick()
local Parried = false

local function GetClosestBall()
    local closestBall, closestDistance = nil, math.huge
    for _, Ball in ipairs(workspace.Balls:GetChildren()) do
        if Ball:GetAttribute("realBall") then
            local HRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
            if HRP then
                local Distance = (HRP.Position - Ball.Position).Magnitude
                if Distance < closestDistance then
                    closestDistance = Distance
                    closestBall = Ball
                end
            end
        end
    end
    return closestBall
end

RunService.Heartbeat:Connect(function()
    if not AutoParryEnabled then return end

    local Ball = GetClosestBall()
    local HRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not Ball or not HRP then return end

    local BallVelocity = Ball.Velocity.Magnitude
    local Distance = (HRP.Position - Ball.Position).Magnitude
    local TimeToReach = Distance / BallVelocity

    -- Ensure the ball is coming towards the player and is within a valid detection range
    local BallDirection = (Ball.Position - HRP.Position).Unit
    local BallToPlayerDotProduct = BallDirection:Dot(HRP.CFrame.LookVector)

    -- Only trigger the parry if the ball is in range, coming towards the player, and within the reaction time window
    if Ball:GetAttribute("target") == Player.Name and not Parried and Distance <= DetectionRange and TimeToReach <= ReactionTime and BallToPlayerDotProduct > 0 then
        -- Simulate the mouse button event (parry action)
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
        
        -- Simulate a physical deflection of the ball (apply a force to it)
        local Direction = (Ball.Position - HRP.Position).unit
        local Force = 500 -- Adjust the force as needed
        Ball:ApplyImpulse(Direction * Force)
        
        Parried = true
        Cooldown = tick() -- Update cooldown after parrying
        print("Parry triggered and ball deflected!")
    end

    -- Reset the parry after the cooldown
    if (tick() - Cooldown) >= 0.2 then
        Parried = false
    end
end)

local AutoParryToggle = Tabs.BladeBal:AddToggle("AutoParryToggle", { Title = "Auto Parry", Default = false })

AutoParryToggle:OnChanged(function()
    AutoParryEnabled = AutoParryToggle.Value
    if AutoParryEnabled then
        print("Auto Parry Enabled!")
    else
        print("Auto Parry Disabled!")
    end
end)

SaveManager:SetLibrary(Ikorz)
InterfaceManager:SetLibrary(Ikorz)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})
InterfaceManager:SetFolder("IkorzScriptHub")
SaveManager:SetFolder("IkorzScriptHub/specific-game")
InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)

Ikorz:Notify({
    Title = "Ikorz",
    Content = "The script has been loaded.",
    Duration = 8
})

SaveManager:LoadAutoloadConfig()
